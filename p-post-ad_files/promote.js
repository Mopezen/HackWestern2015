Kj.Admin.Promote=function(){"use strict";var a={"init":function(){this.defaults(),this.cache(),this.calculateTotal(),Kj.Tracking.initTrackFeaturePurchase({"hasEnabledFeaturesCallback":Kj.Admin.Promote.api.PromoteButtons.hasEnabledFeatures,"enabledFeatureNameCallback":Kj.Admin.Promote.api.PromoteButtons.enabledFeatureName})},"defaults":function(){this.totalPrice=0,this.buttonClasses={"hover":"hover","selected":"selected"},this.selectedFeatures={}},"cache":function(){this.dom={"$itemsContainer":$("#PromoteItems"),"$totalPrice":$(".total-price"),"$selectedItemsContainer":$("#SelectedItems")}},"updateButtonStatus":function(a){this.isFeatureSelected(a)?this.removeFeature(a):this.addFeature(a)},"updateButtonPrice":function(a){var b=this.getButtonFromDaySelector(a),c=this.getSelectedDayPrice(a),d=this.getSelectedDayValue(a);this.setButtonPrice(b,c),this.setFeatureValue(b,d),this.calculateTotal()},"removeFeature":function(a){this.disableDaySelector(a),a.removeClass(this.buttonClasses.selected),this.removePrice(this.getButtonPrice(a)),this.toggleCheckBox(a,!1)},"addFeature":function(a){this.enableDaySelector(a),a.addClass(this.buttonClasses.selected),this.addPrice(this.getButtonPrice(a)),this.toggleCheckBox(a,!0)},"enableDaySelector":function(a){if(this.hasDaySelector(a)===!0){var b=this.getDaySelector(a);b.prop("disabled",!1)}},"disableDaySelector":function(a){if(this.hasDaySelector(a)===!0){var b=this.getDaySelector(a);b.prop("disabled",!0)}},"getDaySelector":function(a){return a.siblings(".day-selector")},"getButtonFromDaySelector":function(a){return a.siblings(".button")},"getSelectedDayPrice":function(a){return a.find(":selected").attr("data-price")},"getButtons":function(){return this.dom.$itemsContainer.find(".button:not(.active, .disabled)")},"getSelectedDayValue":function(a){return a.find(":selected").val()},"hasDaySelector":function(a){return a.hasClass("has-days")},"removePrice":function(a){this.setTotalPrice(this.totalPrice-a)},"addPrice":function(a){this.setTotalPrice(this.totalPrice+a)},"setFeatureValue":function(a,b){a.find(".feature-value").val(b)},"setButtonPrice":function(a,b){a.find(".price").html(this.formatPrice(b)),a.find(".price").attr("data-price",b)},"getButtonPrice":function(a){return parseFloat(a.find(".price").attr("data-price"))},"setTotalPrice":function(a){this.totalPrice=a,this.updateTotalPrice()},"updateTotalPrice":function(){this.dom.$totalPrice.html(this.formatPrice(this.totalPrice))},"toggleCheckBox":function(a,b){var c=this.findCheckBox(a),d=c.val();c.prop("checked",b),b===!1?this.selectedFeatures.splice(this.selectedFeatures.indexOf(d),1):this.selectedFeatures.push(d),this.updateForm(),Kj.Tracking.api.TrackFeaturePurchase.trackFeatureClick(this.getFeatureName(a))},"enabledFeatureName":function(){return this.findFeatureName(this.getFirstEnabledFeature())},"getFirstEnabledFeature":function(){return this.getButtons().find("input[type=checkbox]:checked").eq(0)},"findCheckBox":function(a){return a.find("input")},"formatPrice":function(a){return $.formatNumber(a,{"format":"fr_CA"===Kj.extVars.locale?"#,##0.00 $":"$#,##0.00","locale":"fr_CA"===Kj.extVars.locale?"fr":"ca"})},"calculateTotal":function(){var a=this;this.totalPrice=0;var b=this.getButtons().filter("."+this.buttonClasses.selected);this.selectedFeatures=[],b.each(function(){a.totalPrice+=a.getButtonPrice($(this))}).find("input[type=checkbox]").each(function(){a.selectedFeatures.push($(this).val())}),this.updateForm(),this.setTotalPrice(this.totalPrice)},"updateForm":function(){this.dom.$selectedItemsContainer.html("").append(this.selectedFeatures.map(function(a){return $('<input type="hidden" name="featureIdentifier" value="'+a+'" />')}))},"isFeatureSelected":function(a){return a.hasClass(this.buttonClasses.selected)},"hasEnabledFeatures":function(){return this.getButtons().find("input[type=checkbox]:checked").length>0},"getFeatureName":function(a){return a.attr("data-feature-name")}},b={"init":function(){this.defaults(),this.cache(),this.bindEvents()},"defaults":function(){},"cache":function(){this.dom={"$featureRecommendations":$(".recommended-feature a"),"$featureRows":$(".select-feature")}},"bindEvents":function(){var a=this;a.dom.$featureRows.each(function(){var a=$(this).attr("data-feature-name"),b=$(this).find("input.calculate-total"),c=$('a[data-target="'+a+'"]');b.qtip({"content":{"text":Kj.extVars.featureAdded},"show":{"target":c,"event":"click"},"hide":{"event":!1,"inactive":2500,"effect":function(a){$(this).fadeOut()}},"position":{"my":"bottom center","at":"center"},"style":{"classes":"qtip-no-min-width"}})}),this.dom.$featureRecommendations.click(function(b){var c=$(this).attr("data-target"),d=a.dom.$featureRows.filter('[data-feature-name="'+c+'"]').find("input");d.prop("checked",!0),d.trigger("change"),b.preventDefault()})}};return{"test":{"PromoteButtons":a},"initPromoteButtons":function(){a.init()},"initFeatureRecommendation":function(){b.init()},"api":{"PromoteButtons":{"hasEnabledFeatures":function(){return a.hasEnabledFeatures()},"enabledFeatureName":function(){return a.enabledFeatureName()},"updateButtonStatus":function(b){a.updateButtonStatus(b)},"updateButtonPrice":function(b){a.updateButtonPrice(b)},"calculateTotal":function(){a.calculateTotal()}}}}}();